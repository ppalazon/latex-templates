#+TITLE:  LaTeX Templates
#+AUTHOR: Xavier Garrido
#+EMAIL:  xavier.garrido@gmail.com
#+OPTIONS: toc:nil

* Introduction
This file should provide a saner set of LaTeX templates for articles, memos or
beamer templates. It uses all the versatility of =org-mode= from Emacs,
especially all the tangling power of =org-babel=.

The document firstly explains how to install the style files. The [[Org preamble]]
section introduces some general options for LaTeX to work with =org-mode= and
=xelatex=. Finally, each secton define some templates to be used either with
pure LaTeX document or Beamer class.

* Installation
LaTeX =*.sty= files will be installed in =TEXMFHOME= which normally points to
your personal LaTeX home directory. All files within this directory will be see
by any =(xe/pdf)latex= compilation process. If =TEXMFHOME= is not properly defined then
export it to some place
#+BEGIN_SRC sh
  export TEXMFHOME="/some/place/on/your/computer"
#+END_SRC

Given the definition of =TEXMFHOME= environment variable, you can just use the
Makefile shipped with this package and run the following command
#+BEGIN_SRC sh
  make
#+END_SRC
It will install all the style files defined in this unique file.

You can also tweak what you really want to be exported by changing the [[style_files][export table]].

* Org preamble
:PROPERTIES:
:TANGLE: org-preamble.sty
:END:

This section defines =org= preamble and settings for documents exported from
=.org= to =.tex= files. The basic use is to add =\usepackage{org-preamble}= in
your LaTeX document.

** Basics
#+BEGIN_SRC latex
  \NeedsTeXFormat{LaTeX2e}
  \ProvidesPackage{org-preamble}[2013/03/03 v0.01 Bundling of Preamble items for Org to LaTeX export]
#+END_SRC

** Style options
Options can be passed to =org-preamble= style file within =\usepackage[options]=
call. For the time being, I have only copied/pasted how to declare such options
but do not use it.
#+BEGIN_SRC latex :tangle no
  \RequirePackage{ifthen}
  \newboolean{@fr} %
  \setboolean{@fr}{false} %
  \DeclareOption{fr}{
    \setboolean{@fr}{true}
  }
  \ProcessOptions
#+END_SRC

** Packages requirements
*** AMS packages
#+BEGIN_SRC latex
  \RequirePackage{amsmath,amssymb}
#+END_SRC
*** Listings package
[[https://code.google.com/p/minted/][minted]] is a package that facilitates expressive syntax highlighting in LaTeX
using the powerful Pygments library. The package also provides options to
customize the highlighted source code output using =fancyvrb=.
#+BEGIN_SRC latex
  \RequirePackage[cache]{minted}
#+END_SRC

*** Unicode typesettings aka XeTeX
#+BEGIN_SRC latex
  \RequirePackage{ifxetex}
  \ifxetex
  \RequirePackage{fontspec}
  \RequirePackage{xunicode}
  %%\else
  \fi
#+END_SRC

*** hyperref package
#+BEGIN_SRC latex
  \RequirePackage{hyperref}
#+END_SRC
*** [[http://www.ctan.org/pkg/pifont][pifont]] package
#+BEGIN_SRC latex
  \RequirePackage{pifont}
#+END_SRC
*** graphics package
#+BEGIN_SRC latex
  \RequirePackage{graphicx}
  \graphicspath{
    {./plot/}
    {./figures/}
  }
#+END_SRC
*** comment package
#+BEGIN_SRC latex
  \RequirePackage{comment}
#+END_SRC
*** [[http://www.texample.net/tikz/][tikz]] package
#+BEGIN_SRC latex
  \RequirePackage{tikz}
  \usetikzlibrary{positioning,arrows,decorations,backgrounds,patterns,matrix,shapes,fit,calc,shadows,plotmarks,spy}
#+END_SRC

We use the external library from =tikz= to cache i.e. produce a =pdf= file of
each =tikzpicture=. =tikz/external= looks if the pdf exist and if not, export it.
#+BEGIN_SRC latex
  %%\tikzset{
  %%  external/system call={%
  %%    xelatex -shell-escape
  %%    -halt-on-error -interaction=batchmode
  %%    -jobname "\image" "\texsource"}}
  %%\tikzexternalize[prefix=latex.d/]
  \input "|mkdir -p latex.d"
  \input "|mkdir -p /tmp/latex.d"
#+END_SRC
*** rotating package
This since to be needed if =sidewaystable= are used
#+BEGIN_SRC latex
  \RequirePackage{rotating}
#+END_SRC
*** Bold math package
#+BEGIN_SRC latex
  \RequirePackage{bm}
#+END_SRC
*** =multirow=
#+BEGIN_SRC latex
  \RequirePackage{multirow}
#+END_SRC
*** units package
#+BEGIN_SRC latex
  \RequirePackage{units}
#+END_SRC
*** xspace package
#+BEGIN_SRC latex
  \RequirePackage{xspace}
#+END_SRC
* Article styles
** Memoir article styles                                       :development:
:PROPERTIES:
:TANGLE: memoir-article-style.sty
:END:

Some article styles and page layout tweaks for the [[http://www.ctan.org/tex-archive/macros/latex/contrib/memoir/][memoir]] LaTeX class.

Most of the code come from [[https://github.com/kjhealy/latex-custom-kjh][Kieran Healy's LaTeX custom files]].

*** Blank footnote
This piece of code is pretty useful for adding a /blank/ footnote to be used for
corresponding author reference... Use =\symbolfoonote[0]{Footnote text}=.
#+BEGIN_SRC latex
  \long\def\symbolfootnote[#1]#2{%
    \begingroup%
    \def\thefootnote{\fnsymbol{footnote}}\footnote[#1]{#2}%
    \endgroup}
#+END_SRC

*** =hyperref= package
#+BEGIN_SRC latex
  \colorlet{blue}{blue!50!black}
  \colorlet{red}{red!80!black}
  \hypersetup{
    xetex,
    colorlinks=true,
    urlcolor=red,
    filecolor=blue,
    linkcolor=red,
    plainpages=false,
    pdfpagelabels,
    bookmarksnumbered,
    pagebackref
  }
#+END_SRC

*** Set font
#+BEGIN_SRC latex
  \RequirePackage{eulervm}
  \setsansfont[Mapping=tex-text]{Myriad Pro}
  \setmonofont[Mapping=tex-text,Scale=MatchLowercase]{Inconsolata}
  \setromanfont[Mapping=tex-text, Numbers=OldStyle]{Minion Pro}
#+END_SRC

*** Smaller table font size
#+BEGIN_SRC latex :tangle no
  \RequirePackage{floatrow}
  \DeclareFloatFont{tiny}{\tiny}% "scriptsize" is defined by floatrow, "tiny" not
  \floatsetup[table]{font=tiny}
#+END_SRC

*** Wider page size
#+BEGIN_SRC latex
  \RequirePackage{a4wide}
#+END_SRC

*** Chapter style
#+BEGIN_SRC latex
  \makechapterstyle{article-sans}{
    \setsecheadstyle{\sffamily\bfseries}
    \setsubsecheadstyle{\color{black!75}\normalsize\sffamily}
    \setaftersubsubsecskip{-1em}
    \setsubsubsecheadstyle{\small\itshape}
    \renewcommand{\contentsname}{}
    \renewcommand{\printchaptername}{}
    \renewcommand{\chapternamenum}{}
    \renewcommand{\chapnumfont}{\chaptitlefont}
    \renewcommand{\printchapternum}{\chapnumfont \thechapter\space}
    \renewcommand{\afterchapternum}{}
    \renewcommand{\printchaptername}{\secheadstyle}
    \renewcommand{\cftchapterfont}{\normalfont\sffamily}
    \renewcommand{\cftchapterpagefont}{\normalfont\sffamily}
    \renewcommand{\cftchapterpresnum}{\sffamily}
    %\renewcommand{\cftchapterleader}{}
    %\renewcommand{\cftchapterafterpnum}{\cftparfillskip}
    \captiontitlefont{\small}
    %\settocdepth{chapter}
    \maxsecnumdepth{chapter}
    \setsecnumdepth{chapter}

    %% reduce skip after section heading
    \setaftersecskip{1.7ex}

    %% set name of bibliography to 'references'
    %%\renewcommand{\bibname}{\mdseries\Large\sffamily References}

    % % Title flush left
    \pretitle{\par\vskip 3em
      \begin{flushleft}\LARGE\sffamily\bfseries}
    \posttitle{\end{flushleft}\par\vskip 0.5em}
    \preauthor{\begin{flushleft}\Large}
    \postauthor{\end{flushleft}}
    \predate{\begin{flushleft}\normalsize}
    \postdate{\end{flushleft}}

    %% 'abstract' bigger skip from title
    %%\addto\captionsamerican{\renewcommand*{\abstractname}{}}
    \renewcommand{\abstractnamefont}{\normalfont\scriptsize}
    \renewcommand{\abstracttextfont}{\normalfont\scriptsize}
    \abstractrunin
  }
\chapterstyle{article-sans}
#+END_SRC

** SuperNEMO article style
*** DocDB article
:PROPERTIES:
:TANGLE: supernemo-article-style.sty
:END:

**** Basics
#+BEGIN_SRC latex
  \NeedsTeXFormat{LaTeX2e}
  \ProvidesPackage{supernemo-article-style}[2013/07/03 v0.01 Bundling of SuperNEMO article items]
#+END_SRC

**** Package options
#+BEGIN_SRC latex
  \RequirePackage{kvoptions}
  \SetupKeyvalOptions{
    family=snemo,
    prefix=snemo@
  }
  \DeclareBoolOption[false]{nologo}
  \DeclareBoolOption[false]{classic}
  \ProcessKeyvalOptions*
#+END_SRC
**** Package requirements
***** =hyperref= package
#+BEGIN_SRC latex
  \hypersetup{
    xetex,
    colorlinks=true,
    urlcolor=blue,
    filecolor=blue,
    linkcolor=red,
    plainpages=false,
    pdfpagelabels,
    bookmarksnumbered,
    pagebackref
  }
#+END_SRC
**** Set fonts
#+BEGIN_SRC latex
  \setmonofont[Scale=0.9]{Inconsolata}
  \RequirePackage{mathpazo}

  \ifthenelse{\boolean{snemo@classic}}{
    \setmainfont
        [ BoldFont       = texgyrepagella-bold.otf ,
          ItalicFont     = texgyrepagella-italic.otf ,
          BoldItalicFont = texgyrepagella-bolditalic.otf ]
        {texgyrepagella-regular.otf}
  }{
    \setsansfont[Mapping=tex-text]{Myriad Pro}
    \setromanfont[Mapping=tex-text, Numbers=OldStyle]{Minion Pro}
  }
#+END_SRC

**** Graphics packages
#+BEGIN_SRC latex
  \RequirePackage{wrapfig}
#+END_SRC

**** Color
#+BEGIN_SRC latex
  \definecolor{sncolor}{rgb}{0,0,0}
#+END_SRC

**** Authoring & bibliography
[[http://www.ctan.org/pkg/authblk][The package]] redefines the =\author= command to work as normal or to allow a
footnote style of author/affiliation input.
#+BEGIN_SRC latex
  \RequirePackage{authblk}
#+END_SRC

#+BEGIN_SRC latex
  \RequirePackage[nottoc,notlof,notlot]{tocbibind}
#+END_SRC

**** Geometry
#+BEGIN_SRC latex
  \RequirePackage{a4wide}
  \linespread{1.02}
#+END_SRC

**** Layout
***** Logo
#+BEGIN_SRC latex
  \newcommand{\snlogo}{
    \resizebox{!}{35mm}{
      \begin{tikzpicture}[y=-1cm]
        \tikzstyle{line}=[line width=3.5pt]

        \path[fill=white] (3.5,0.5) rectangle (16.5,13);
        \draw[line,cap=round,sncolor] (15.77099,10.87346) +(-146:5.28649) arc (-146:-94:5.28649);
        \draw[line,cap=round,sncolor] (14.21807,12.1247) +(-123:5.16183) arc (-123:-77:5.16183);
        \draw[line] (5.94556,9.46111) +(139:0.23466) arc (139:319:0.23466);
        \draw[line] (6.29889,9.15444) +(139:0.2332) arc (139:-41:0.2332);
        \draw[line] (6.65333,8.85017) +(139:0.23393) arc (139:319:0.23393);
        \draw[line] (7.00556,8.54222) +(139:0.23393) arc (139:-41:0.23393);
        \draw[line] (7.36,8.23796) +(140:0.23321) arc (140:319:0.23321);
        \draw[line] (7.71222,7.93) +(139:0.23466) arc (139:-41:0.23466);
        \draw[line] (8.06667,7.62462) +(140:0.23321) arc (140:319:0.23321);
        \draw[line] (5.94556,3.93889) +(-139:0.23466) arc (-139:-319:0.23466);
        \draw[line] (6.29889,4.24556) +(-139:0.2332) arc (-139:41:0.2332);
        \draw[line] (6.65333,4.54983) +(-139:0.23393) arc (-139:-319:0.23393);
        \draw[line] (7.00556,4.85778) +(-139:0.23393) arc (-139:41:0.23393);
        \draw[line] (7.36,5.16204) +(-140:0.23321) arc (-140:-319:0.23321);
        \draw[line] (7.71222,5.47) +(-139:0.23466) arc (-139:41:0.23466);
        \draw[line] (8.06667,5.77538) +(-140:0.23321) arc (-140:-319:0.23321);

        \draw[line] (4.66667,9.66667) -- (15.36667,9.66667);
        \draw[line] (4.66667,9.96667) -- (15.36667,9.96667);
        \draw[line] (4.66667,10.26667) -- (15.36667,10.26667);
        \draw[line] (4.66667,3.16667) -- (15.36667,3.16667);
        \draw[line] (4.66667,3.46667) -- (15.36667,3.46667);
        \draw[line] (4.66667,3.76667) -- (15.36667,3.76667);

        \path[draw=sncolor,line,fill=white] (9.98667,6.56222) circle (2cm);

        \draw[line,cap=round] (9.91952,6.72683) +(149:1.52587) arc (149:229:1.52587);
        \draw[line,cap=round] (9.96484,6.84433) +(-129:1.64987) arc (-129:-85:1.64987);
        \draw[line,cap=round] (10.20558,6.59684) +(55:1.8469) arc (55:151:1.8469);
        \draw[line,cap=round] (9.96256,6.58451) +(-85:1.39531) arc (-85:-33:1.39531);
        \draw[line,cap=round] (10.05707,6.51492) +(-35:1.28299) arc (-35:31:1.28299);
        \draw[line,cap=round] (10.09998,6.44356) +(35:1.28202) arc (35:97:1.28202);
        \draw[line,cap=round] (10.09126,6.72875) +(99:1.00595) arc (99:170:1.00595);
        \draw[line,cap=round] (10.03469,6.72368) +(169:0.95117) arc (169:237:0.95117);
        \draw[line,cap=round] (9.94585,6.58108) +(-124:0.77764) arc (-124:-44:0.77764);
        \draw[line,cap=round] (9.93399,6.50534) +(-41:0.72926) arc (-41:36:0.72926);
        \draw[line,cap=round] (10.03246,6.57945) +(35:0.60217) arc (35:126:0.60217);
        \draw[line,cap=round] (10.01821,6.63888) +(130:0.54491) arc (130:224:0.54491);
        \draw[line,cap=round] (9.91514,6.60478) +(-121:0.45168) arc (-121:-56:0.45168);
        \draw[line,cap=round] (10.00024,6.51523) +(-49:0.32865) arc (-49:43:0.32865);
        \draw[line,cap=round] (10.00457,6.53792) +(44:0.3094) arc (44:156:0.3094);
        \draw[line,cap=round] (9.85985,6.60767) +(162:0.13797) arc (162:337:0.13797);

        %%\fontfamily{phv}\fontseries{b}
        \sf\fontsize{30.0}{36.0}\selectfont{}
        \path (10.1,11.8) node[text=sncolor,anchor=base] {c~o~l~l~a~b~o~r~a~t~i~o~n};
        \path (10,2.28889) node[text=sncolor,anchor=base] {s~~u~~p~~e~~r~~n~~e~~m~~o};

      \end{tikzpicture}%
    }
  }
#+END_SRC

***** Cover page
#+BEGIN_SRC latex
  \newcommand{\HRule}{\rule{\linewidth}{1mm}}
  \renewcommand*{\maketitle}{}
  \renewenvironment{abstract}{%
    \color{sncolor}
    \pagestyle{empty}
    \vspace*{\stretch{2}}
    \begin{flushright}
      \HRule
      \\[9mm]
        {
          \bf \Huge \@title
        }
        \\[15mm]
        \large

        \snlogo\hfill%
        %%\includegraphics[height=35mm]{supernemo_logo} \hfill%
        \parbox[b]{10cm}{\begin{flushright}
            \@author
        \end{flushright}}
        \\[5mm]
        \HRule
        \\[9mm]
    \end{flushright}
    \begin{center}
      \bf\large \abstractname
    \end{center}
    \begin{center}
      \begin{minipage}[b]{12cm}
        \small
  }%
  {%
      \end{minipage}
    \end{center}
    \vspace*{\stretch{2}}
    \begin{center}
      Document version 0.1\\
      %% Document revision \SVNrevision
    \end{center}
    %% \pagestyle{plain}
    \newpage
  }
#+END_SRC

***** Footnote
#+BEGIN_SRC latex
  \RequirePackage{fancyhdr}
  \renewcommand{\footnoterule}{\color{sncolor!90}%
    \vskip-\footruleskip\vskip-\footrulewidth%
    \vspace{10pt}\hrule width\columnwidth height1.5pt \vspace{5pt} \color{sncolor!90}}
  \renewcommand{\thefootnote}{\alph{footnote}}
  \interfootnotelinepenalty=10000
#+END_SRC

***** Caption
#+BEGIN_SRC latex
  \RequirePackage[margin=20pt,labelfont=bf,font=footnotesize,labelsep=endash]{caption}
#+END_SRC

*** Notes
:PROPERTIES:
:TANGLE: supernemo-note-style.sty
:END:

**** Basics
#+BEGIN_SRC latex
  \NeedsTeXFormat{LaTeX2e}
  \ProvidesPackage{supernemo-notes-style}[2013/10/16 v0.01 Bundling of SuperNEMO simulation style]
#+END_SRC
**** Package requirements
#+BEGIN_SRC latex
  \hypersetup{
    xetex,
    colorlinks=true,
    urlcolor=blue,
    filecolor=blue,
    linkcolor=blue,
    plainpages=false,
    pdfpagelabels,
    bookmarksnumbered,
    pagebackref
  }
#+END_SRC
**** Fonts
#+BEGIN_SRC latex
  \setmonofont[Scale=0.9]{Inconsolata}
  \setsansfont[Mapping=tex-text]{Myriad Pro}
  \setromanfont[Mapping=tex-text, Numbers=OldStyle]{Minion Pro}
  \RequirePackage[eulergreek,EULERGREEK]{sansmath}
  \sansmath
#+END_SRC
**** Colors
#+BEGIN_SRC latex
  \definecolor{red}{RGB}{221,42,43}
  \definecolor{green}{RGB}{105,182,40}
  \definecolor{blue}{RGB}{0,51,153}
  \definecolor{orange}{RGB}{192,128,64}
  \definecolor{gray}{gray}{0.7}
#+END_SRC
**** Minted lexer
#+BEGIN_SRC latex
  \usemintedstyle{snemo}
#+END_SRC
**** Layout
***** Geometry
#+BEGIN_SRC latex
  \RequirePackage{a4wide}
  \linespread{1.02}
#+END_SRC
***** Cover page
#+BEGIN_SRC latex
  \newcommand{\HRule}{\rule{\linewidth}{1mm}}
  \renewcommand*{\maketitle}{%
    {\color{blue}
    \pagestyle{empty}
    \vspace*{\stretch{2}}
    \begin{flushright}
      \HRule
      \\[9mm]
        {
          \bf\sffamily \Huge \@title
        }
        \\[5mm]
        \HRule
        \\[9mm]
    \end{flushright}}
  }
#+END_SRC
***** Footnote
#+BEGIN_SRC latex
  \RequirePackage{fancyhdr}
  \renewcommand{\footnoterule}{\color{blue!75}%
    \vskip-\footruleskip\vskip-\footrulewidth%
    \vspace{10pt}\hrule width\columnwidth height1.5pt \vspace{5pt} \color{blue!75}}
  \renewcommand{\thefootnote}{\alph{footnote}}
  \interfootnotelinepenalty=10000
#+END_SRC
***** Caption
#+BEGIN_SRC latex
  \RequirePackage[margin=20pt,labelfont=bf,font=footnotesize,labelsep=endash]{caption}
#+END_SRC
**** Appearance tweaks
***** Remove TOC dots
#+BEGIN_SRC latex
  \renewcommand\@dotsep{10000}
#+END_SRC
***** Change section colors
#+BEGIN_SRC latex
  \RequirePackage{titlesec}
  \titleformat*{\section}{\usekomafont{sectioning}\usekomafont{section}\color{blue}}
#+END_SRC
***** SN@ilWare logo
#+BEGIN_SRC latex
  \RequirePackage{xspace}
  \def\Snailware{\mbox{$\overline{\text{SN@il}}$%
      \hspace{.05em}\protect\raisebox{.2ex}%
             {$\protect\underline{\text{Ware}}$}}\xspace}
#+END_SRC

* KOMA/LaTeX letter styles

This part holds some LaTeX styles for cover letter. This is mainly inspired by
this [[http://stefano.italians.nl/archives/55][tutorial]]. First, the basics are defined namely the layout of the cover
letter. Then /personal data/ informations are set given the usecase
(french/english).

** Cover letter layout
*** Packages
#+NAME: kpackages
#+BEGIN_SRC latex :results none :tangle no
  \usepackage{fontspec}
  \usepackage{xltxtra}
  \usepackage{marvosym}
  \usepackage{graphicx}
  \usepackage[dvipdfm]{geometry}
  \usepackage{pst-barcode}
#+END_SRC
*** Fonts
#+NAME: kfonts
#+BEGIN_SRC latex :results none :tangle no
  \setmainfont{GaramondNo8}
#+END_SRC
*** Lengths
#+NAME: klengths
#+BEGIN_SRC latex :results none :tangle no
  \@setplength{firstheadvpos}{0pt}%
  \@setplength{firstheadwidth}{\paperwidth}%
  \@setplength{firstfootvpos}{\paperheight}%
  \@addtoplength[-]{firstfootvpos}{\useplength{toaddrvpos}}%
  \@addtoplength{refvpos}{-1.5\baselineskip}%
  \@newplength{infocolwidth}%
  % Kohm & Morawski 2005, C.7. Modifikationen (Modifications)
  \ifdim \textwidth<0.666\paperwidth
   \@setplength{infocolwidth}{.22222\paperwidth}%
  \else
   \@setplength{infocolwidth}{0.1667\paperwidth}%
   \fi
#+END_SRC

*** Page body
Shift the page body on the left to make room for personal data and logo.
#+NAME: kbody
#+BEGIN_SRC latex :results none :tangle no
  \setlength{\parindent}{0cm}
  \setlength{\oddsidemargin}{\useplength{toaddrhpos}}%
  \addtolength{\oddsidemargin}{-1in}%
  % Take care that the shift stays intact even after recalculating the page
  % layout (see Kohm & Morawski 2005, section C.7)
  \l@addto@macro{\@typearea@end}{%
    \setlength{\oddsidemargin}{\useplength{toaddrhpos}}%
   \addtolength{\oddsidemargin}{-1in}%
  }
#+END_SRC

*** Fancy header
#+NAME: kheader
#+BEGIN_SRC latex :results none :tangle no
  \firsthead{%
   \fontsize{8}{9}\sffamily
   \hspace*{\fill}%
   \begin{picture}(0,0)%
   \put(0,0){\parbox[t]{\useplength{infocolwidth}}{%
   \vspace{\useplength{toaddrvpos}}%
   \usekomavar{fromlogo}%
   }%
   }%
   \put(0,0){\parbox[t]{\useplength{infocolwidth}}{%
   \raggedright
   \vspace{\useplength{refvpos}}%
   \vspace{\useplength{refaftervskip}}%
   \usekomavar{place}\usekomavar{placeseparator}\\
   \usekomavar{date}\\[10\baselineskip]
   \usekomavar{fromname}\\
   \usekomavar{fromaddress}\\
   [\baselineskip]
   \Telefon~\usekomavar{fromphone}\\
   \Letter~\usekomavar{fromemail}
   }%
  }%
   \end{picture}%
   \hspace*{\useplength{infocolwidth}}%
  }%

  % avoid the display of the date in the default position
  \l@addto@macro\@firstheadfootfield{\setkomavar{date}{}}
#+END_SRC

*** Full layout
#+NAME: klayout
#+BEGIN_SRC latex :results none :tangle no
  <<kpackages>>
  <<kfonts>>
  <<klengths>>
  <<kbody>>
  <<kheader>>
#+END_SRC

** Personal data
*** English
:PROPERTIES:
:TANGLE: english.lco
:END:

#+BEGIN_SRC latex
  \ProvidesFile{english.lco}[]
  \usepackage[english]{babel}
#+END_SRC

#+BEGIN_SRC latex :noweb yes
  <<klayout>>
#+END_SRC

#+BEGIN_SRC latex
  \setkomavar{fromname}{Xavier Garrido}
  \setkomavar{fromaddress}{Laboratoire de l'Accélérateur Linéaire\\Centre Scientifique d'Orsay\\91898 Orsay Cedex}
  \setkomavar{fromemail}{garrido@lal.in2p3.fr}
  \setkomavar{fromphone}{+33 1 64 46 84 28}
  \setkomavar{fromfax}{}
  \setkomavar{fromurl}{}
  %%\setkomavar{fromlogo}{\includegraphics[width=3cm]{logo_upsud_bw}}
  \setkomavar{place}{Orsay}
  \setkomavar{signature}{Xavier Garrido\\Assistant professor at University Paris-Sud}
#+END_SRC

#+BEGIN_SRC latex
  \endinput
#+END_SRC

*** French
:PROPERTIES:
:TANGLE: french.lco
:END:

#+BEGIN_SRC latex
  \ProvidesFile{french.lco}[]
  \usepackage[frenchb]{babel}
#+END_SRC

#+BEGIN_SRC latex :noweb yes
  <<klayout>>
#+END_SRC

#+BEGIN_SRC latex
  \setkomavar{fromname}{Xavier Garrido}
  \setkomavar{fromaddress}{Laboratoire de l'Accélérateur Linéaire\\Centre Scientifique d'Orsay\\91898 Orsay Cedex}
  \setkomavar{fromemail}{garrido@lal.in2p3.fr}
  \setkomavar{fromphone}{+33 1 64 46 84 28}
  \setkomavar{fromfax}{}
  \setkomavar{fromurl}{}
  %%\setkomavar{fromlogo}{\includegraphics[width=3cm]{logo_upsud_bw}}
  \setkomavar{place}{Orsay}
  \setkomavar{signature}{Xavier Garrido\\Maître de Conférence à l'Université Paris-Sud}
#+END_SRC

#+BEGIN_SRC latex
  \endinput
#+END_SRC

* Beamer styles
:PROPERTIES:
:TANGLE: custom-beamer.sty
:END:
** Special progress bar in footline
#+NAME: generate_line
#+HEADERS: :var color="gray"
#+BEGIN_SRC sh :results output :tangle no
  echo '  \color{'$color'}% to color the progressbar'
  echo '  \hspace*{-\beamer@leftmargin}%'
  echo '  \rule{\beamer@leftmargin}{2pt}%'
  echo '  \rlap{\rule{\dimexpr'
  echo '      \beamer@startpageofframe\dimexpr'
  echo '      \beamer@rightmargin+\textwidth\relax/\beamer@endpageofdocument}{1pt}}'
  echo '  % next empty line is mandatory!'
  echo ' '
  echo '  \vspace{.0\baselineskip}'
  echo '         {}'
#+END_SRC

#+NAME: generate_footline
#+HEADERS: :var style="default" :var color="gray"
#+BEGIN_SRC sh :results output :tangle no :noweb yes
  echo '\let\@email\@empty'
  echo '\@ifundefined{email}{%'
  echo '  \newcommand\email[1]{\gdef\@email{#1}}}{}'
  echo '\defbeamertemplate{footline}{cbfootline}{%'
  if [ "${style}" == "ddpfo" ]; then
      echo '  \usebeamerfont{page number in head/foot}'
      echo '  \hspace{1em}\insertshortdate\,--\,\insertshortauthor\hfill'
      echo '  \insertpagenumber\,/\,\insertpresentationendpage'
      echo '  \kern1em\vskip-1pt'
      <<generate_line>>
  elif [ "${style}" == "snemo" ]; then
      echo '  \usebeamerfont{page number in head/foot}'
      echo '  \hspace{1em}\insertshortdate\,'
      echo '  \if\@email\@empty'
      echo '  --\,\insertshortauthor\hfill'
      echo '  \else'
      echo '  \ding{46} \href{mailto:\@email}{\color{generic3}\@email}\hfill'
      echo '  \fi'
      echo '  \insertpagenumber\,/\,\insertpresentationendpage'
      echo '  \kern1em'
      #echo '  \progressbar@progressbar'
  elif [ "${style}" == "cpp_teaching" ]; then
      echo '  \usebeamerfont{page number in head/foot}'
      echo '  \hspace{1em}\inserttitle\hfill'
      echo '  \insertpagenumber'
      echo '  \kern1em\vskip2pt'
      <<generate_line>>
  fi
  echo '}'
#+END_SRC
** Beamer general settings
*** Basics
#+BEGIN_SRC latex
  \NeedsTeXFormat{LaTeX2e}
  \ProvidesPackage{custom-beamer}[2013/09/03 v0.01 Custom beamer templates]
#+END_SRC
*** Package options
#+BEGIN_SRC latex
  \RequirePackage{kvoptions}
  \SetupKeyvalOptions{
     family=cb,
     prefix=cb@
   }
   \DeclareBoolOption[false]{nologo}
   \DeclareBoolOption[false]{notitlelogo}
   \DeclareBoolOption[false]{noheaderlogo}
   \DeclareBoolOption[false]{noauthor}
   \DeclareBoolOption[false]{ddpfo}
   \DeclareBoolOption[false]{snemo}
   \DeclareBoolOption[false]{cpp_teaching}
   \ProcessKeyvalOptions*
#+END_SRC
*** Parsing options
Here we parse result of =ProcessKeyvalOptions= done previously in order to set
different booleans used in the nex section.
#+BEGIN_SRC latex
  \RequirePackage{ifthen}
  \newboolean{has_driver_name}
  \setboolean{has_driver_name}{false}
  \ifthenelse{\boolean{cb@ddpfo}}{
    \setboolean{has_driver_name}{true}
  }{}
  \ifthenelse{\boolean{cb@snemo}}{
    \setboolean{has_driver_name}{true}
  }{}
  \ifthenelse{\boolean{cb@cpp_teaching}}{
    \setboolean{has_driver_name}{true}
    \setboolean{cb@nologo}{true}
    \setboolean{cb@noauthor}{true}
  }{}
  \ifthenelse{\boolean{has_driver_name}}{
  }{
    \PackageWarning{custom-beamer}{You do not specify a 'driver' name !}}{
  }
  \ifthenelse{\boolean{cb@nologo}}{
    \setboolean{cb@notitlelogo}{true}
    \setboolean{cb@noheaderlogo}{true}
  }{}
#+END_SRC
*** Package requirements
**** =hyperref= package
#+BEGIN_SRC latex
  \hypersetup{
    xetex,
    colorlinks=true,
    urlcolor=green,
    filecolor=green,
    linkcolor=red,
    plainpages=false,
    pdfpagelabels,
    bookmarksnumbered,
    pagebackref
  }
#+END_SRC
**** Sans math
#+BEGIN_SRC latex
  \RequirePackage[eulergreek,EULERGREEK]{sansmath}
  \sansmath
#+END_SRC
*** Default themes
#+BEGIN_SRC latex
  \usetheme{default}
  \usecolortheme{whale}
#+END_SRC
*** Color definitions
Since color must be applied in a very last time, we define a bash script to be
called within =postamble= part of [[Template settings]]
#+NAME: generate_beamer_colors
#+BEGIN_SRC latex :results output :tangle no
  \setbeamercolor{structure}{fg=generic2}
  \setbeamercolor{alerted text}{fg=generic0}
  \setbeamercolor{example text}{fg=generic1}
  \setbeamercolor{block title}{use=structure,fg=structure.bg, bg=structure.fg}
  \setbeamercolor{block body}{use=structure, fg=structure.fg, bg=structure.bg}
  \setbeamercolor{frametitle}{use=structure, fg=structure.fg, bg=}
  \setbeamercolor{example title}{use=example,fg=example.bg, bg=example.fg}
  \setbeamercolor{example body}{use=example, fg=example.fg, bg=example.bg}
  \setbeamercolor{itemize item}{fg=generic2}
  \setbeamercolor{footnote}{fg=generic3}
  \setbeamercolor{footnote mark}{fg=generic3}

  \setbeamercolor{ruc_upper}{fg=white,bg=red}
  \setbeamercolor{ruc_lower}{fg=red,bg=white}
  \setbeamercolor{guc_upper}{fg=white,bg=green}
  \setbeamercolor{guc_lower}{fg=green,bg=white}
  \setbeamercolor{buc_upper}{fg=white,bg=blue}
  \setbeamercolor{buc_lower}{fg=blue,bg=white}

  \setbeamercolor{lruc}{fg=white,bg=red!10}
  \setbeamercolor{lrtuc}{fg=red,bg=red!10}
  \setbeamercolor{lguc}{fg=white,bg=green!10}
  \setbeamercolor{lgtuc}{fg=green,bg=green!10}
  \setbeamercolor{lbuc}{fg=white,bg=blue!10}
  \setbeamercolor{lbtuc}{fg=blue,bg=blue!10}
  \setbeamercolor{louc}{fg=white,bg=orange!10}
  \setbeamercolor{lotuc}{fg=orange,bg=orange!10}
  \setbeamercolor{lwuc}{fg=blue,bg=white}
#+END_SRC

*** Font
#+BEGIN_SRC latex
  \setmonofont[Scale=0.9]{Inconsolata}
  \newfontfamily{\Handwritten}{Gunny Handwriting}
  \setbeamerfont{page number in head/foot}{size=\tiny}
#+END_SRC
*** Beamer options
#+BEGIN_SRC latex
  \DeclareOptionBeamer{shadow}[true]{\def\beamer@themerounded@shadow{#1}}
  \ExecuteOptionsBeamer{shadow=true}
  \ProcessOptionsBeamer

  \setbeamercovered{transparent}
  \setbeamertemplate{blocks}[rounded][shadow=\beamer@themerounded@shadow]
#+END_SRC
*** Title page definition
First, make title frame plain (no page number, not footline...)
#+BEGIN_SRC latex
  \def\maketitle{\ifbeamer@inframe\titlepage\else\frame[plain,noframenumbering]{\titlepage}\fi}
#+END_SRC

Also add a logo if any
#+BEGIN_SRC latex
  \ifthenelse{\boolean{cb@notitlelogo}}{}{
    \titlegraphic{\resizebox{!}{15mm}{\logo}}}
#+END_SRC

Set =subtitle= font to =\scriptsize=
#+BEGIN_SRC latex
  \setbeamerfont{subtitle}{size=\scriptsize,parent=title}
#+END_SRC

Then define the custom beamer template
#+BEGIN_SRC latex
  \newcommand{\insertprefixtitle}{}
  \defbeamertemplate*{title page}{custom}[1][colsep=-4bp,
    rounded=true,shadow=\beamer@themerounded@shadow]{
    \vbox{}
    \vfill
    \begin{centering}
      \begin{beamercolorbox}[sep=8pt,center,#1]{title}
        \usebeamerfont{title}\insertprefixtitle\inserttitle\par%
        \ifx\insertsubtitle\@empty%
        \else%
        \vskip0.25em%
               {\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\vspace{2ex}\insertsubtitle\par}%
               \fi%
      \end{beamercolorbox}%
      \vskip1em\par
      \ifthenelse{\boolean{cb@noauthor}}{}{
        \begin{beamercolorbox}[sep=8pt,center,#1]{author}
          \usebeamerfont{author}\usebeamercolor[bg]{title}\insertauthor
        \end{beamercolorbox}
      }
      \begin{beamercolorbox}[sep=8pt,center,#1]{institute}
        \usebeamerfont{institute}\usebeamercolor[bg]{title}\insertinstitute
      \end{beamercolorbox}
      %%\begin{beamercolorbox}[sep=8pt,center,#1]{date}
      %%  \usebeamerfont{date}\insertdate
      %%\end{beamercolorbox}
      \vskip0.5em{\usebeamercolor[fg]{titlegraphic}\inserttitlegraphic\par}
    \end{centering}
    \vfill
  }
#+END_SRC

*** Appendix page definition
This tweak is used to include =appendix= page with the name style as =title=
page. First, rename the =appendix= name :
#+BEGIN_SRC latex
  \renewcommand{\appendix}{
    \begin{frame}[plain]{}
      \partpage
    \end{frame}
  }
#+END_SRC

Then use almost the default part page style but include the command =\appendix=
in order to keep the total page number unchanged.
#+BEGIN_SRC latex
  \defbeamertemplate*{part page}{custom}[1][colsep=-4bp,
    rounded=true,shadow=\beamer@themerounded@shadow]{
    \begin{centering}
      \vskip1em\par
      \begin{beamercolorbox}[sep=16pt,center,#1]{part title}
        \usebeamerfont{part title}\appendixname\par
      \end{beamercolorbox}
    \end{centering}
  }
#+END_SRC
*** Adding logo to frametitle
#+BEGIN_SRC latex
  \RequirePackage[absolute,overlay]{textpos}
  \ifthenelse{\boolean{cb@noheaderlogo}}{}{
    \addtobeamertemplate{frametitle}{}{%
      \begin{textblock}{14}(13.9,0.25)
        \resizebox{!}{8mm}{\logo}
      \end{textblock}
    }
  }
#+END_SRC
*** Colored block environment
We define a new colored bow environment that can be also used for =orgmode=
headline. The parameters are the following one :
- box width,
- box color,
- text options such as =\centering= of text size,
- =x= and =y= positions,
- box title.

The last parameters, if specified, are used within a =textblock=
environment, otherwise a =minipage= is defined.
#+BEGIN_SRC latex
  \newcommand{\IfNoValueOrEmptyTF}[3]{\IfNoValueTF{#1}{#2}{\if\relax\detokenize{#1}\relax#2\else#3\fi}}
  \RequirePackage{xparse}
  \NewDocumentEnvironment{cbox}{o o o o o d()}{
    \IfNoValueOrEmptyTF{#4}{
      \begin{center}
        \begin{minipage}[c]{\IfNoValueOrEmptyTF{#1}{0.9\linewidth}{#1}}}{
      \begin{textblock}{\IfNoValueOrEmptyTF{#1}{10}{#1}}(#4,#5)}
    \begin{beamerboxesrounded}[upper=\IfNoValueOrEmptyTF{#2}{lbtuc}{#2}, lower=\IfNoValueOrEmptyTF{#2}{lbtuc}{#2}, shadow=false]
      {\IfNoValueOrEmptyTF{#3}{}{#3}\IfNoValueOrEmptyTF{#6}{}{#6}}
      \IfNoValueOrEmptyTF{#3}{}{#3}
  }{
    \end{beamerboxesrounded}
    \IfNoValueOrEmptyTF{#4}{\end{minipage}\end{center}}{\end{textblock}}
  }
#+END_SRC

*** Animated prompt environment
Taken from this [[http://tex.stackexchange.com/questions/37869/beamer-animations-how-to-simulate-terminal-input-and-output][post forum]] on stackexchange. For some obscure reasons, this
piece of code can not be included into the [[C++ teaching style]].
#+BEGIN_SRC latex
  \RequirePackage{animate}
  \RequirePackage{expl3}
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %commands for simulating terminal in/output
  %\scroll[<line separator string>]{<width as TeX dim>}
  %                             {<number of lines>}{terminal text line}
  %\clearbuf  %clears line buffer
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \ExplSyntaxOn
  \seq_new:N\g_linebuffer_seq
  \seq_new:N\g_inputline_seq
  \newcommand\scroll[4][§§]{
    \color{generic2}
    \seq_set_split:Nnn\g_inputline_seq{#1}{#4}
    \seq_map_inline:Nn\g_inputline_seq{
      \seq_gput_right:Nx\g_linebuffer_seq{##1}
      \int_compare:nT{\seq_count:N\g_linebuffer_seq>#3}{
        \seq_gpop_left:NN\g_linebuffer_seq\dummy
      }
    }
    \mbox{\begin{minipage}[t][#3\baselineskip]{#2}
        \ttfamily
        \seq_map_inline:Nn\g_linebuffer_seq{\mbox{##1}\\}
    \end{minipage}}
  }
  \newcommand\clearbuf{\seq_gclear:N\g_linebuffer_seq}
  \ExplSyntaxOff
#+END_SRC
*** Footline
Remove navigation symbols
#+BEGIN_SRC latex
  \beamertemplatenavigationsymbolsempty
#+END_SRC

Add special footline with a slick progress bar
#+BEGIN_SRC latex :noweb yes
  \def\progressbar@progressbar{} % the progress bar
  \newcount\progressbar@tmpcounta% auxiliary counter
  \newcount\progressbar@tmpcountb% auxiliary counter
  \newdimen\progressbar@pbht %progressbar height
  \newdimen\progressbar@pbwd %progressbar width
  \newdimen\progressbar@tmpdim % auxiliary dimension

  \progressbar@pbwd=\linewidth
  \progressbar@pbht=1pt

  % the progress bar
  \def\progressbar@progressbar{%
    \tikzexternaldisable

    \progressbar@tmpcounta=\insertframenumber
    \progressbar@tmpcountb=\inserttotalframenumber
    \progressbar@tmpdim=\progressbar@pbwd
    \multiply\progressbar@tmpdim by \progressbar@tmpcounta
    \divide\progressbar@tmpdim by \progressbar@tmpcountb

    \begin{tikzpicture}[very thin]
      \draw[generic3,line width=\progressbar@pbht] (0pt, 0pt) -- ++ (1.25\progressbar@tmpdim,0pt);
    \end{tikzpicture}%
  }
  \ifthenelse{\boolean{has_driver_name}}{
    \ifthenelse{\boolean{cb@ddpfo}}{
      <<generate_footline(style="ddpfo", color="generic3")>>
    }{}
    \ifthenelse{\boolean{cb@snemo}}{
      <<generate_footline(style="snemo", color="generic3")>>
    }{}
    \ifthenelse{\boolean{cb@cpp_teaching}}{
      <<generate_footline(style="cpp_teaching", color="generic3")>>
    }{}
    \setbeamertemplate{footline}[cbfootline]{}
    \setbeamercolor{footline}{use=structure, fg=generic3, bg=structure.bg}
  }{}
#+END_SRC
*** Footnote
Redefine footnote template for beamer
#+BEGIN_SRC latex
  \defbeamertemplate*{footnote}{custom}
                     {
                       \parbox{11.5cm}{\raggedleft
                           \tiny
                           \parindent 1em\noindent%
                           \hbox to 1em{\hfil\insertfootnotemark}\insertfootnotetext%
                       }
                       \vskip +1pt
                     }
#+END_SRC

Use personal footnote symbol starting with dagger and not with asterisk.
#+BEGIN_SRC latex
  \def\@fnsymbol#1{\ensuremath{\ifcase#1\or \dagger\or \ddagger\or
    \mathsection\or \mathparagraph\or \|\or **\or \dagger\dagger
     \or \ddagger\ddagger \else\@ctrerr\fi}}
  \renewcommand{\thefootnote}{\fnsymbol{footnote}}
  \renewcommand{\footnoterule}{}
#+END_SRC

Reset counter for every beamer frame
#+BEGIN_SRC latex
  \RequirePackage{perpage}
  \MakePerPage{footnote}
#+END_SRC

If the text within the footnote is very long, LaTeX may split the footnote over
several pages. You can prevent LaTeX from doing so by increasing the penalty for
such an operation.
#+BEGIN_SRC latex
  \interfootnotelinepenalty=10000
#+END_SRC
** Template settings
Given the =driver= to be used, generic colors, special title inclusion are set
up. Practically, everything can be done within this section.

*** D2PFO style
**** Preamble
#+BEGIN_SRC latex
  \ifthenelse{\boolean{cb@ddpfo}}{
#+END_SRC
**** University Paris Sud logo
#+BEGIN_SRC latex
  \renewcommand{\logo}{
    \definecolor{c6ec72e}{RGB}{110,199,46}
    \definecolor{c094268}{RGB}{9,66,104}
    \definecolor{c615e5e}{RGB}{97,94,94}
    \tikzsetnextfilename{upsud_logo}
    \begin{tikzpicture}[y=0.80pt,x=0.80pt,yscale=-1, inner sep=0pt, outer sep=0pt]
      \begin{scope}[cm={{1.25,0.0,0.0,-1.25,(0.0,259.175)}}]
        \begin{scope}[scale=0.100]
          \path[fill=c6ec72e,nonzero rule] (1065.3800,1989.9500) .. controls
          (1065.3800,1989.9500) and (759.1450,1989.9500) .. (599.4690,1989.9500) ..
          controls (330.2660,1989.9500) and (138.2620,1898.6500) .. (158.4730,1664.4200)
          .. controls (194.6170,1245.6400) and (945.3550,1356.8400) ..
          (1071.4900,827.3790) .. controls (1163.8900,1293.7700) and
          (717.2070,1335.8800) .. (501.6210,1501.6100) .. controls (417.1910,1566.4800)
          and (400.7030,1749.1600) .. (573.9180,1749.1600) .. controls
          (634.0940,1749.1600) and (937.8160,1749.1600) .. (937.8160,1749.1600) --
          (1065.3800,1989.9500);
          \path[fill=c094268,nonzero rule] (0.0000,1663.5700) .. controls
          (0.0000,1201.3200) and (366.9570,1104.8900) .. (585.0590,975.6410) .. controls
          (676.5780,921.3280) and (685.8590,728.0700) .. (512.5390,728.0700) .. controls
          (452.4770,728.0700) and (4.6992,728.0700) .. (4.6992,728.0700) --
          (4.6992,19.5703) -- (257.5270,128.3320) -- (257.5270,487.2620) .. controls
          (339.7660,487.2620) and (425.6090,487.2620) .. (487.0940,487.2620) .. controls
          (756.4100,487.2620) and (928.0980,577.7380) .. (928.0980,812.8790) .. controls
          (928.0980,1298.0100) and (103.7540,1176.2000) .. (0.0000,1663.5700);
          \path[fill=c615e5e,nonzero rule] (1848.4400,1733.6600) -- (1729.1800,1944.3900)
          .. controls (1709.9600,1977.7500) and (1699.3700,1993.8000) ..
          (1668.4600,1993.8000) .. controls (1638.4200,1993.8000) and
          (1621.1700,1990.8500) .. (1621.1700,1990.8500) -- (1621.1700,1658.7700) --
          (1677.6300,1658.7700) -- (1677.6300,1921.8100) -- (1809.8900,1689.0500) ..
          controls (1824.9600,1663.3200) and (1836.8700,1656.0400) ..
          (1863.0800,1656.0400) .. controls (1888.7400,1656.0400) and
          (1904.9000,1658.0000) .. (1904.9000,1658.0000) -- (1904.9000,1991.0500) --
          (1848.4400,1991.0500) -- (1848.4400,1733.6600);
          \path[fill=c615e5e,nonzero rule] (2205.4600,1723.9700) -- (2099.6300,1989.3300)
          -- (2099.0900,1991.0500) -- (2040.0100,1991.0500) -- (2157.7300,1693.1700) ..
          controls (2169.3200,1664.3600) and (2182.7300,1652.6500) ..
          (2205.9000,1653.1400) .. controls (2227.9600,1653.6100) and
          (2237.7800,1653.6100) .. (2237.7800,1653.6100) -- (2366.5500,1991.0500) --
          (2308.0100,1991.0500) -- (2205.4600,1723.9700);
          \path[fill=c615e5e,nonzero rule] (3805.1300,2073.4500) -- (3746.1200,2073.4500)
          -- (3697.0000,2007.1200) -- (3734.1200,2007.1200) -- (3805.1300,2073.4500);
          \path[fill=c615e5e,nonzero rule] (1508.6800,1773.3000) .. controls
          (1508.6800,1728.7400) and (1483.9900,1704.3400) .. (1437.8000,1704.3400) ..
          controls (1391.4900,1704.3400) and (1367.4700,1728.7400) ..
          (1367.4700,1773.3000) -- (1367.4700,1989.3300) -- (1311.7700,1989.3300) --
          (1311.7700,1768.5000) .. controls (1311.7700,1704.6800) and
          (1358.6200,1654.9700) .. (1439.4400,1654.9700) .. controls
          (1518.7200,1654.9700) and (1567.3200,1704.6800) .. (1567.3200,1768.5000) --
          (1567.3200,1989.3300) -- (1508.6800,1989.3300) -- (1508.6800,1773.3000);
          \path[fill=c615e5e,nonzero rule] (1960.0600,1660.5100) -- (2021.5327,1660.5100)
          -- (2021.5327,1988.4510) -- (1960.0600,1988.4510) -- (1960.0600,1660.5100) --
          cycle;
          \path[fill=c615e5e,nonzero rule] (3307.5400,1940.9500) -- (3396.9900,1940.9500)
          -- (3396.9900,1660.5100) -- (3458.4700,1660.5100) -- (3458.4700,1940.9500) --
          (3547.8000,1940.9500) -- (3547.8000,1988.4500) -- (3307.5400,1988.4500) --
          (3307.5400,1940.9500);
          \path[fill=c615e5e,nonzero rule] (3215.0300,1660.5100) -- (3276.5183,1660.5100)
          -- (3276.5183,1988.4510) -- (3215.0300,1988.4510) -- (3215.0300,1660.5100) --
          cycle;
          \path[fill=c615e5e,nonzero rule] (3072.9400,1854.9100) .. controls
          (3039.6400,1870.5600) and (3010.8000,1884.1300) .. (3010.8000,1906.2200) ..
          controls (3010.8000,1926.9100) and (3022.6000,1938.2500) ..
          (3043.8900,1938.2500) -- (3157.2700,1938.2500) -- (3157.2700,1990.0700) --
          (3049.7900,1990.0700) .. controls (2993.1100,1990.0700) and
          (2956.4100,1956.2900) .. (2956.4100,1903.9000) .. controls
          (2956.4100,1848.3600) and (3006.8700,1824.4600) .. (3051.1900,1803.4700) ..
          controls (3086.4700,1786.8000) and (3117.0700,1772.3700) ..
          (3117.0700,1746.4300) .. controls (3117.0700,1727.8700) and
          (3111.2800,1710.7000) .. (3069.3300,1710.7000) -- (2954.1100,1710.7000) --
          (2954.1100,1658.9300) -- (3077.0900,1658.9300) .. controls
          (3135.3200,1658.9300) and (3171.5600,1693.8800) .. (3171.5600,1750.1000) ..
          controls (3171.5600,1808.4700) and (3116.8500,1834.1900) ..
          (3072.9400,1854.9100);
          \path[fill=c615e5e,nonzero rule] (2917.6400,1886.0400) .. controls
          (2917.6400,2006.5500) and (2800.1300,1990.8500) .. (2682.4000,1990.3100) --
          (2659.5700,1990.3100) -- (2659.5700,1660.0800) -- (2714.5000,1660.0800) --
          (2714.5000,1940.2300) .. controls (2829.7200,1947.6600) and
          (2863.1400,1930.9500) .. (2863.1400,1886.0400) .. controls
          (2863.1400,1844.5400) and (2827.7600,1829.3300) .. (2764.7500,1829.3300) --
          (2754.0400,1829.3300) -- (2737.7600,1781.0900) -- (2854.7400,1658.7100) --
          (2924.5200,1658.7100) -- (2804.8100,1783.2400) .. controls
          (2896.4500,1793.4800) and (2917.6400,1831.2400) .. (2917.6400,1886.0400);
          \path[fill=c615e5e,nonzero rule] (2400.7100,1660.5100) -- (2605.8400,1661.3600)
          -- (2605.8400,1708.8600) -- (2462.2200,1708.8600) -- (2462.2200,1804.0000) --
          (2583.7800,1804.0000) -- (2601.8800,1851.4300) -- (2462.2200,1851.4300) --
          (2462.2200,1940.9500) -- (2605.8400,1940.9500) -- (2605.8400,1988.4500) --
          (2400.7100,1988.4500) -- (2400.7100,1660.5100);
          \path[fill=c615e5e,nonzero rule] (3585.9200,1660.5100) -- (3790.9100,1661.3600)
          -- (3790.9100,1708.8600) -- (3647.4000,1708.8600) -- (3647.4000,1804.0000) --
          (3768.8700,1804.0000) -- (3787.0900,1851.4300) -- (3647.4000,1851.4300) --
          (3647.4000,1940.9500) -- (3790.9100,1940.9500) -- (3790.9100,1988.4500) --
          (3585.9200,1988.4500) -- (3585.9200,1660.5100);
          \path[fill=c615e5e,nonzero rule] (3007.0900,1261.8500) .. controls
          (3007.0900,1502.5400) and (2772.1700,1471.2500) .. (2537.1600,1470.0200) --
          (2491.3900,1470.0200) -- (2491.3900,810.5590) -- (2601.1500,810.5590) --
          (2601.1500,1370.1100) .. controls (2831.2500,1384.9600) and
          (2898.1100,1351.6000) .. (2898.1100,1261.8500) .. controls
          (2898.1100,1179.0200) and (2827.4200,1148.5700) .. (2701.7300,1148.5700) --
          (2680.3200,1148.5700) -- (2647.6800,1052.2200) -- (2881.3800,807.8200) --
          (3020.8400,807.8200) -- (2781.6800,1056.6400) .. controls
          (2964.7000,1077.0400) and (3007.0900,1152.3700) .. (3007.0900,1261.8500);
          \path[fill=c615e5e,nonzero rule] (1503.7600,1052.2200) .. controls
          (1749.0600,1032.1500) and (1828.7800,1144.6400) .. (1828.7800,1261.8500) ..
          controls (1828.7800,1502.5400) and (1593.8600,1471.2500) ..
          (1358.8400,1470.0200) -- (1313.1800,1470.0200) -- (1313.1800,810.5590) --
          (1422.9400,810.5590) -- (1422.9400,1370.1100) .. controls
          (1653.0600,1384.9600) and (1719.7900,1351.6000) .. (1719.7900,1261.8500) ..
          controls (1719.7900,1179.0200) and (1651.4200,1141.4500) ..
          (1523.4200,1148.5700) -- (1502.1200,1148.5700) -- (1471.4400,1056.7800) --
          (1503.7600,1052.2200);
          \path[fill=c615e5e,nonzero rule] (3123.5000,807.8200) -- (3246.4880,807.8200) --
          (3246.4880,1476.2730) -- (3123.5000,1476.2730) -- (3123.5000,807.8200) --
          cycle;
          \path[fill=c615e5e,nonzero rule] (2005.4900,1125.1500) -- (2101.9200,1368.6400)
          -- (2210.0500,1125.1500) -- (2005.4900,1125.1500) -- cycle(2350.9200,807.8200)
          -- (2472.0600,807.8200) -- (2164.6200,1475.6700) -- (2032.5800,1475.6700) --
          (1760.2000,806.7300) -- (1879.8900,807.8200) -- (1968.4800,1031.6000) --
          (2251.6600,1031.6000) -- (2350.9200,807.8200);
          \path[fill=c615e5e,nonzero rule] (3617.7100,810.5590) -- (3371.6300,810.5590) --
          (3371.6300,913.8980) -- (3602.2000,913.8980) .. controls (3685.7400,913.8980)
          and (3697.4200,948.2810) .. (3697.4200,985.3790) .. controls
          (3697.4200,1037.2300) and (3636.4700,1066.0900) .. (3565.8300,1099.4600) ..
          controls (3476.8200,1141.5000) and (3376.1000,1189.2000) ..
          (3376.1000,1300.2700) .. controls (3376.1000,1404.9500) and
          (3449.4000,1472.4800) .. (3563.0000,1472.4800) -- (3790.2400,1472.4800) --
          (3790.2400,1369.0000) -- (3551.0700,1369.0000) .. controls
          (3508.4900,1369.0000) and (3484.8800,1346.2200) .. (3484.8800,1304.8100) ..
          controls (3484.8800,1260.7300) and (3542.5500,1233.6200) ..
          (3609.1800,1202.2000) .. controls (3697.0000,1160.9700) and
          (3806.3000,1109.4500) .. (3806.3000,992.6990) .. controls (3806.3000,880.3400)
          and (3734.0200,810.5590) .. (3617.7100,810.5590) -- (3617.7100,810.5590);
          \path[fill=c615e5e,nonzero rule] (1563.7200,4.0508) -- (1317.5600,4.0508) --
          (1317.5600,107.5200) -- (1548.1100,107.5200) .. controls (1631.7600,107.5200)
          and (1643.3400,141.9610) .. (1643.3400,179.0780) .. controls
          (1643.3400,230.8790) and (1582.4000,259.6600) .. (1511.7300,293.1290) ..
          controls (1422.8400,335.1210) and (1322.1400,382.8200) .. (1322.1400,493.8910)
          .. controls (1322.1400,598.4690) and (1395.3100,666.0900) ..
          (1508.9000,666.0900) -- (1736.2800,666.0900) -- (1736.2800,562.6410) --
          (1496.8800,562.6410) .. controls (1454.4000,562.6410) and (1430.9200,539.8520)
          .. (1430.9200,498.4220) .. controls (1430.9200,454.2500) and
          (1488.5800,427.1990) .. (1555.0900,395.8980) .. controls (1642.9000,354.4800)
          and (1752.2200,302.9100) .. (1752.2200,186.3200) .. controls
          (1752.2200,73.9102) and (1680.0300,4.0508) .. (1563.7200,4.0508) --
          (1563.7200,4.0508);
          \path[fill=c615e5e,nonzero rule] (2339.1400,666.3400) -- (2210.2700,666.3400) --
          (2210.2700,236.5590) .. controls (2210.2700,147.4410) and (2160.9100,98.6992)
          .. (2068.5000,98.6992) .. controls (1976.1100,98.6992) and
          (1927.7300,147.4410) .. (1927.7300,236.5590) -- (1927.7300,666.3400) --
          (1816.4400,666.3400) -- (1816.4400,227.2190) .. controls (1816.4400,99.4883)
          and (1910.0400,0.0000) .. (2071.8900,0.0000) .. controls (2230.3500,0.0000)
          and (2327.4600,99.4883) .. (2327.4600,227.2190) -- (2327.4600,566.4410);
          \path[fill=c615e5e,nonzero rule] (2336.9600,26.7617) .. controls
          (2336.9600,26.7617) and (2361.8500,8.1211) .. (2475.4400,8.6289) .. controls
          (2711.9900,9.7188) and (2813.1300,148.1480) .. (2813.1300,343.8090) ..
          controls (2813.1300,535.2620) and (2673.1200,666.3400) .. (2521.5200,666.3400)
          -- (2210.2700,666.3400) -- (2267.6000,563.2380) -- (2477.2900,563.2380) ..
          controls (2644.2800,563.2380) and (2696.2800,429.5390) .. (2696.2800,339.8710)
          .. controls (2696.2800,242.0120) and (2649.1900,106.1910) ..
          (2485.1600,106.1910) .. controls (2444.8400,106.1910) and (2382.4900,117.1290)
          .. (2382.4900,117.1290) -- (2336.9600,26.7617);
        \end{scope}
      \end{scope}
    \end{tikzpicture}
  }
#+END_SRC
**** Colors
#+BEGIN_SRC latex
  \definecolor{red}{RGB}{221,42,43}
  \definecolor{green}{RGB}{132,184,24}
  \definecolor{blue}{RGB}{0,72,112}
  \definecolor{gray}{RGB}{107,108,110}

  \colorlet{generic0}{green}
  \colorlet{generic1}{green}
  \colorlet{generic2}{blue}
  \colorlet{generic3}{gray}
#+END_SRC
**** Changing appendix name
#+BEGIN_SRC latex
  \renewcommand{\appendixname}{Annexes}
#+END_SRC
**** Postamble
#+BEGIN_SRC latex :noweb yes
  <<generate_beamer_colors>>
  }{}
#+END_SRC
*** SuperNEMO style
**** Preamble
#+BEGIN_SRC latex
  \ifthenelse{\boolean{cb@snemo}}{
#+END_SRC
**** Logo
#+BEGIN_SRC latex
  \newcommand{\snlogo}{
    \resizebox{!}{15mm}{
      \begin{tikzpicture}[y=-1cm]
        \tikzstyle{line}=[line width=3.5pt]

        \path[fill=white] (3.5,0.5) rectangle (16.5,13);
        \draw[line,cap=round] (15.77099,10.87346) +(-146:5.28649) arc (-146:-94:5.28649);
        \draw[line,cap=round] (14.21807,12.1247) +(-123:5.16183) arc (-123:-77:5.16183);
        \draw[line] (5.94556,9.46111) +(139:0.23466) arc (139:319:0.23466);
        \draw[line] (6.29889,9.15444) +(139:0.2332) arc (139:-41:0.2332);
        \draw[line] (6.65333,8.85017) +(139:0.23393) arc (139:319:0.23393);
        \draw[line] (7.00556,8.54222) +(139:0.23393) arc (139:-41:0.23393);
        \draw[line] (7.36,8.23796) +(140:0.23321) arc (140:319:0.23321);
        \draw[line] (7.71222,7.93) +(139:0.23466) arc (139:-41:0.23466);
        \draw[line] (8.06667,7.62462) +(140:0.23321) arc (140:319:0.23321);
        \draw[line] (5.94556,3.93889) +(-139:0.23466) arc (-139:-319:0.23466);
        \draw[line] (6.29889,4.24556) +(-139:0.2332) arc (-139:41:0.2332);
        \draw[line] (6.65333,4.54983) +(-139:0.23393) arc (-139:-319:0.23393);
        \draw[line] (7.00556,4.85778) +(-139:0.23393) arc (-139:41:0.23393);
        \draw[line] (7.36,5.16204) +(-140:0.23321) arc (-140:-319:0.23321);
        \draw[line] (7.71222,5.47) +(-139:0.23466) arc (-139:41:0.23466);
        \draw[line] (8.06667,5.77538) +(-140:0.23321) arc (-140:-319:0.23321);

        \draw[line] (4.66667,9.66667) -- (15.36667,9.66667);
        \draw[line] (4.66667,9.96667) -- (15.36667,9.96667);
        \draw[line] (4.66667,10.26667) -- (15.36667,10.26667);
        \draw[line] (4.66667,3.16667) -- (15.36667,3.16667);
        \draw[line] (4.66667,3.46667) -- (15.36667,3.46667);
        \draw[line] (4.66667,3.76667) -- (15.36667,3.76667);

        \draw[line,fill=white] (9.98667,6.56222) circle (2cm);

        \draw[line,cap=round] (9.91952,6.72683) +(149:1.52587) arc (149:229:1.52587);
        \draw[line,cap=round] (9.96484,6.84433) +(-129:1.64987) arc (-129:-85:1.64987);
        \draw[line,cap=round] (10.20558,6.59684) +(55:1.8469) arc (55:151:1.8469);
        \draw[line,cap=round] (9.96256,6.58451) +(-85:1.39531) arc (-85:-33:1.39531);
        \draw[line,cap=round] (10.05707,6.51492) +(-35:1.28299) arc (-35:31:1.28299);
        \draw[line,cap=round] (10.09998,6.44356) +(35:1.28202) arc (35:97:1.28202);
        \draw[line,cap=round] (10.09126,6.72875) +(99:1.00595) arc (99:170:1.00595);
        \draw[line,cap=round] (10.03469,6.72368) +(169:0.95117) arc (169:237:0.95117);
        \draw[line,cap=round] (9.94585,6.58108) +(-124:0.77764) arc (-124:-44:0.77764);
        \draw[line,cap=round] (9.93399,6.50534) +(-41:0.72926) arc (-41:36:0.72926);
        \draw[line,cap=round] (10.03246,6.57945) +(35:0.60217) arc (35:126:0.60217);
        \draw[line,cap=round] (10.01821,6.63888) +(130:0.54491) arc (130:224:0.54491);
        \draw[line,cap=round] (9.91514,6.60478) +(-121:0.45168) arc (-121:-56:0.45168);
        \draw[line,cap=round] (10.00024,6.51523) +(-49:0.32865) arc (-49:43:0.32865);
        \draw[line,cap=round] (10.00457,6.53792) +(44:0.3094) arc (44:156:0.3094);
        \draw[line,cap=round] (9.85985,6.60767) +(162:0.13797) arc (162:337:0.13797);

        \sf\bf\fontsize{40.0}{36.0}\selectfont{}
        \path (10.1,11.8)  node[anchor=base] {collaboration};
        \path (10,2.48889) node[anchor=base] {SuperNEMO};

      \end{tikzpicture}%
    }
  }
#+END_SRC

**** Colors
#+BEGIN_SRC latex
  \definecolor{red}{RGB}{221,42,43}
  \definecolor{green}{RGB}{105,182,40}
  \definecolor{blue}{RGB}{51,51,179}
  \definecolor{orange}{RGB}{192,128,64}
  \definecolor{gray}{gray}{0.7}

  \colorlet{generic0}{red}
  \colorlet{generic1}{green}
  \colorlet{generic2}{blue}
  \colorlet{generic3}{gray}
#+END_SRC
**** Change =hyperref= setup
#+BEGIN_SRC latex
  \hypersetup{
    xetex,
    colorlinks=true,
    urlcolor=blue,
    filecolor=blue,
    linkcolor=blue,
    plainpages=false,
    pdfpagelabels,
    bookmarksnumbered,
    pagebackref
  }

#+END_SRC
**** Postamble
#+BEGIN_SRC latex  :noweb yes
  <<generate_beamer_colors>>
  }{}
#+END_SRC
* Exporting styles
:PROPERTIES:
:TANGLE: latex-templates.sh
:END:

Given the generation of LaTeX styles from the previous items, the files are
exported to =$TEXMFHOME= to make them available from everywhere.

** List of files to export
#+NAME: style_files
| $TEXMFHOME/tex/latex/commonstuff                 | org-preamble.sty            |
| $TEXMFHOME/tex/latex/commonstuff                 | memoir-article-style.sty    |
| $TEXMFHOME/tex/latex/commonstuff                 | supernemo-article-style.sty |
| $TEXMFHOME/tex/latex/commonstuff                 | supernemo-note-style.sty    |
| $TEXMFHOME/tex/latex/commonstuff/koma-letter-lco | english.lco                 |
| $TEXMFHOME/tex/latex/commonstuff/koma-letter-lco | french.lco                  |
| $TEXMFHOME/tex/latex/commonstuff                 | custom-beamer.sty           |

** Script to do the export
#+NAME: export_script(dirs=style_files[,0], files=style_files[,1])
#+BEGIN_SRC sh :shebang #!/bin/bash
  if [ ! -d $TEXMFHOME ]; then
      echo "ERROR: No TEXMFHOME installation !"
      return 1
  fi

  mode="install"

  if [ "$1" == "clean" ]; then
      mode="clean"
  fi

  ff=( $files )
  dd=( $dirs )

  for i in ${!ff[*]}
  do
      a_dir=$(eval echo ${dd[$i]})
      a_file=${ff[$i]}
      if [ $mode = install ]; then
          echo "NOTICE: Installing ${a_file} into ${a_dir}"
          if [ ! -d ${a_dir} ]; then
              echo "NOTICE: Creating directory ${a_dir}"
              mkdir -p ${a_dir}
          fi
          cp ${a_file} ${a_dir}
      elif [ $mode = clean ]; then
          echo "NOTICE: Removing ${a_file} from ${a_dir}"
          rm -f ${a_dir}/${a_file}
      fi
  done
#+END_SRC
